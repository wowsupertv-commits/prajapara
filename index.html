<!DOCTYPE html>
<html lang="kn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DI App TV — Kannada Channels</title>
  <meta name="description" content="DI App TV - Kannada live channels. Stream, search and favourite your channels." />
  <style>
    :root{
      --bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#ff6b35;--radius:12px;
      font-family: Inter, "Noto Sans Kannada", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#07101a 120%);color:#e6eef6;min-height:100vh;}
    header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:46px;height:46px;background:linear-gradient(135deg,#ff9b5c,#ff6b35);border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#07101a}
    .title{font-size:18px;font-weight:700}
    .subtitle{font-size:12px;color:var(--muted)}
    .controls{display:flex;gap:10px;align-items:center}
    .search{background:var(--card);border-radius:999px;padding:8px 12px;display:flex;align-items:center;gap:8px}
    .search input{background:transparent;border:0;outline:0;color:inherit;width:220px}
    .btn{background:var(--accent);border-radius:10px;padding:8px 12px;color:#07101a;font-weight:600;border:0;cursor:pointer}
    .container{display:grid;grid-template-columns:340px 1fr;gap:20px;padding:20px;max-width:1200px;margin:auto}
    .sidebar{background:rgba(255,255,255,0.03);padding:18px;border-radius:var(--radius)}
    .channel-list{display:flex;flex-direction:column;gap:8px;max-height:65vh;overflow:auto}
    .channel-item{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;cursor:pointer}
    .channel-item:hover{background:rgba(255,255,255,0.05)}
    .thumb{width:56px;height:36px;border-radius:6px;background:#122232;display:flex;align-items:center;justify-content:center;font-size:12px;color:var(--muted)}
    .main{display:flex;flex-direction:column;gap:14px}
    video{width:100%;height:420px;background:black;border-radius:8px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px}
    .card{background:var(--card);padding:12px;border-radius:12px}
    .card .ch-thumb{height:110px;border-radius:8px;background:#08161f;display:flex;align-items:center;justify-content:center}
    .card h4{margin:8px 0 4px;font-size:15px}
    .card p{margin:0;font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">DI</div>
      <div>
        <div class="title">DI App TV</div>
        <div class="subtitle">ಕನ್ನಡ ನೇರ ಪ್ರಸಾರ</div>
      </div>
    </div>
    <div class="controls">
      <div class="search">
        <input id="search" placeholder="ಚಾನೆಲ್ ಹುಡುಕಿ" />
      </div>
      <button class="btn" id="refresh">Refresh</button>
    </div>
  </header>

  <main class="container">
    <aside class="sidebar">
      <h4 style="margin-top:0;color:var(--muted)">ಚಾನೆಲ್ ಪಟ್ಟಿ</h4>
      <div id="channelList" class="channel-list"></div>
    </aside>

    <section class="main">
      <video id="player" controls poster="">
        <source id="playerSource" type="application/vnd.apple.mpegurl" />
      </video>
      <h3 id="nowPlaying">ಚಾನೆಲ್ ಆಯ್ಕೆ ಮಾಡಿಲ್ಲ</h3>
      <div id="grid" class="grid"></div>
    </section>
  </main>

  <script>
    const M3U_URL = 'https://iptv-org.github.io/iptv/languages/kan.m3u';
    const listEl = document.getElementById('channelList');
    const gridEl = document.getElementById('grid');
    const player = document.getElementById('player');
    const playerSource = document.getElementById('playerSource');
    const nowPlaying = document.getElementById('nowPlaying');

    async function fetchChannels(){
      listEl.innerHTML = '<div>Loading Kannada channels...</div>';
      try{
        const res = await fetch(M3U_URL);
        const text = await res.text();
        const channels = parseM3U(text);
        renderChannels(channels);
      }catch(e){
        listEl.innerHTML = '<div style="color:red">Failed to load playlist.</div>';
      }
    }

    function parseM3U(data){
      const lines = data.split(/\n/);
      const channels = [];
      let current = {};
      for(let line of lines){
        if(line.startsWith('#EXTINF')){
          const nameMatch = line.match(/,(.*)$/);
          const name = nameMatch ? nameMatch[1].trim() : 'Unknown';
          const logoMatch = line.match(/tvg-logo="(.*?)"/);
          const logo = logoMatch ? logoMatch[1] : '';
          current = {title:name,logo:logo};
        }else if(line.startsWith('http')){
          current.src = line.trim();
          channels.push(current);
          current = {};
        }
      }
      return channels;
    }

    function renderChannels(channels){
      listEl.innerHTML = '';
      gridEl.innerHTML = '';
      channels.forEach(ch=>{
        const item = document.createElement('div');
        item.className = 'channel-item';
        item.innerHTML = `<div class='thumb'>${ch.logo?`<img src='${ch.logo}' style='width:100%;height:100%;object-fit:cover;border-radius:6px'/>`:ch.title[0]}</div><div>${ch.title}</div>`;
        item.addEventListener('click',()=>playChannel(ch));
        listEl.appendChild(item);
        const card = document.createElement('div');
        card.className='card';
        card.innerHTML = `<div class='ch-thumb'>${ch.logo?`<img src='${ch.logo}' style='width:100%;height:100%;object-fit:cover;border-radius:6px'/>`:ch.title}</div><h4>${ch.title}</h4>`;
        card.addEventListener('click',()=>playChannel(ch));
        gridEl.appendChild(card);
      });
    }

    function playChannel(ch){
      playerSource.src = ch.src;
      player.load();
      player.play().catch(()=>{});
      nowPlaying.textContent = ch.title;
    }

    document.getElementById('search').addEventListener('input', e=>{
      const val = e.target.value.toLowerCase();
      document.querySelectorAll('.channel-item').forEach(el=>{
        el.style.display = el.textContent.toLowerCase().includes(val)?'flex':'none';
      });
      document.querySelectorAll('.card').forEach(el=>{
        el.style.display = el.textContent.toLowerCase().includes(val)?'block':'none';
      });
    });

    document.getElementById('refresh').addEventListener('click', fetchChannels);

    fetchChannels();
  </script>
</body>
</html>
